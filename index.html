<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç”Ÿå‹•ç‰ˆèµ·é‡æ©ŸæŠ½ç±¤</title>
    <style>
        * { box-sizing: border-box; }
        body, html { margin: 0; padding: 0; height: 100%; font-family: "Microsoft JhengHei", sans-serif; overflow: hidden; }
        
        .container { display: flex; height: 100vh; }

        /* å·¦å´æ§åˆ¶é¢æ¿ */
        .sidebar {
            width: 280px;
            background-color: #f8f9fa;
            padding: 20px;
            display: flex;
            flex-direction: column;
            border-right: 3px solid #ccc;
            z-index: 20;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        h2 { margin-top: 0; color: #333; font-size: 1.5rem; }
        
        textarea {
            width: 100%;
            height: 200px;
            margin-bottom: 10px;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        textarea:focus { border-color: #ff5722; outline: none; }

        .btn-group { display: flex; gap: 10px; margin-bottom: 20px; }
        
        button {
            flex: 1;
            padding: 12px;
            font-size: 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.1s;
        }
        button:active { transform: scale(0.95); }

        #updateBtn { background-color: #4CAF50; color: white; }
        #drawBtn { background-color: #ff5722; color: white; }
        #drawBtn:disabled { background-color: #ccc; cursor: not-allowed; }

        .result-box {
            margin-top: auto;
            padding: 20px;
            background: #e3f2fd;
            border: 2px dashed #2196f3;
            border-radius: 8px;
            text-align: center;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .result-box h3 { margin: 0 0 5px 0; font-size: 14px; color: #666; }
        .result-name { font-size: 24px; font-weight: bold; color: #d32f2f; }

        /* å³å´éŠæˆ²å€ */
        .game-area {
            flex-grow: 1;
            position: relative;
            background: linear-gradient(to bottom, #B3E5FC 0%, #E1F5FE 60%, #4FC3F7 100%);
            overflow: hidden;
        }

        /* èƒŒæ™¯è£é£¾ï¼šé›² */
        .cloud {
            position: absolute;
            background: rgba(255,255,255,0.8);
            border-radius: 50px;
        }
        .c1 { width: 100px; height: 40px; top: 10%; left: 10%; animation: float 20s infinite linear; }
        .c2 { width: 140px; height: 60px; top: 20%; left: 60%; animation: float 30s infinite linear reverse; }
        
        @keyframes float { from { transform: translateX(0); } to { transform: translateX(50px); } }

        /* å¤§æµ· */
        .sea {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 70%; /* æµ·ä½”æ“šå·¦é‚Š 70% */
            height: 180px;
            background: linear-gradient(to bottom, #0288d1 0%, #01579b 100%);
            z-index: 5;
            border-right: 5px solid rgba(0,0,0,0.1);
        }

        /* ç¢¼é ­å¹³åœ° */
        .pier {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 30%; /* ç¢¼é ­ä½”æ“šå³é‚Š 30% */
            height: 180px;
            background: repeating-linear-gradient(
                45deg,
                #6d4c41,
                #6d4c41 10px,
                #5d4037 10px,
                #5d4037 20px
            );
            box-shadow: inset 5px 0 10px rgba(0,0,0,0.3);
            z-index: 5;
            display: flex;
            align-items: flex-end; /* äººç«™åœ¨åº•éƒ¨ */
            justify-content: center;
            padding-bottom: 20px; /* é›¢åº•éƒ¨ä¸€é»è·é›¢ */
        }

        /* ç¢¼é ­é‚Šç·£çš„æŸ±å­ */
        .pier::before {
            content: '';
            position: absolute;
            left: 0;
            top: 10px;
            width: 10px;
            height: 100%;
            background: #3e2723;
        }

        /* äººç¾¤å®¹å™¨ */
        .crowd-container {
            width: 90%;
            display: flex;
            flex-wrap: wrap-reverse; /* å¾åº•éƒ¨å¾€ä¸Šå †ç–Š */
            justify-content: center;
            gap: 5px;
            position: relative;
            z-index: 6;
        }

        /* å–®å€‹å°äººå¶ */
        .person {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 40px;
            transition: opacity 0.3s;
            position: relative;
        }
        .person-avatar { font-size: 30px; cursor: default; }
        .person-name { 
            background: rgba(255,255,255,0.9); 
            font-size: 10px; 
            padding: 1px 3px; 
            border-radius: 3px; 
            white-space: nowrap; 
            max-width: 60px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        /* è¢«é¸ä¸­æ™‚éš±è—ï¼ˆå› ç‚ºè¦è¢«èµ·é‡æ©ŸæŠ“èµ°ï¼‰ */
        .person.chosen { opacity: 0; }

        /* ================= èµ·é‡æ©Ÿç³»çµ± ================= */
        /* èµ·é‡æ©Ÿæ•´é«”å®¹å™¨ï¼Œç”¨æ–¼æ°´å¹³ç§»å‹• */
        .crane-wrapper {
            position: absolute;
            top: 0;
            left: 100px; /* åˆå§‹ä½ç½®åœ¨æµ·é¢ä¸Š */
            height: 100%;
            width: 100px; /* åªæ˜¯å®šä½é» */
            z-index: 10;
            transition: left 1s ease-in-out; /* æ°´å¹³ç§»å‹•å‹•ç•« */
        }

        /* é ‚éƒ¨æ©«æ¨‘è»Œé“ (è¦–è¦ºè£é£¾) */
        .rail {
            position: absolute;
            top: 40px;
            left: 0;
            width: 100%;
            height: 10px;
            background: #555;
            z-index: 9;
            box-shadow: 0 5px 5px rgba(0,0,0,0.2);
        }

        /* èµ·é‡æ©Ÿæœ¬é«” (é€£æ¥è»Œé“çš„éƒ¨åˆ†) */
        .crane-head {
            position: absolute;
            top: 30px;
            left: -20px; /* è®“ wrapper ä¸­å¿ƒå°æº– */
            width: 40px;
            height: 30px;
            background: #fbc02d;
            border: 2px solid #f57f17;
            border-radius: 5px;
        }

        /* ç¹©ç´¢ */
        .rope {
            position: absolute;
            top: 60px; /* æ¥åœ¨ head ä¸‹é¢ */
            left: 0; /* åœ¨ wrapper ä¸­å¿ƒ */
            width: 4px;
            height: 50px; /* åˆå§‹é•·åº¦ */
            background: #333;
            transform: translateX(-50%);
            transition: height 1s linear; /* å‡é™å‹•ç•« */
        }

        /* çˆªå­ */
        .claw {
            position: absolute;
            bottom: -25px;
            left: -15px;
            width: 34px;
            height: 25px;
            border: 4px solid #444;
            border-top: none;
            border-radius: 0 0 15px 15px;
            transition: transform 0.2s;
        }
        .claw.closed { transform: scaleX(0.7); border-color: #d32f2f; }

        /* è¢«æŠ“ä½çš„äºº (è·Ÿéš¨çˆªå­) */
        .victim-on-claw {
            position: absolute;
            top: 100%; /* åœ¨çˆªå­ä¸‹æ–¹ */
            left: 50%;
            transform: translateX(-50%);
            display: none; /* åˆå§‹éš±è— */
            flex-direction: column;
            align-items: center;
        }
        .victim-on-claw .avatar { 
            font-size: 35px; 
            animation: struggle 0.2s infinite alternate; 
        }
        .victim-on-claw .name { 
            background: #fff; padding: 2px 5px; border-radius: 4px; font-weight: bold; font-size: 12px; border: 1px solid #333;
        }

        @keyframes struggle { from { transform: rotate(-15deg); } to { transform: rotate(15deg); } }

        /* æ‰è½çš„äºº (è„«é›¢èµ·é‡æ©Ÿå¾Œ) */
        .falling-victim {
            position: absolute;
            display: none;
            flex-direction: column;
            align-items: center;
            z-index: 8;
        }
        .falling-victim.animate {
            animation: dropAnim 0.8s cubic-bezier(0.6, 0.04, 0.98, 0.335) forwards;
        }

        @keyframes dropAnim {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            80% { opacity: 1; }
            100% { transform: translateY(400px) rotate(180deg); opacity: 0; }
        }

        /* æ°´èŠ± */
        .splash {
            position: absolute;
            bottom: 160px; /* æµ·å¹³é¢ç•¥ä½ */
            left: 0; /* ç”± JS æ§åˆ¶ */
            width: 0; height: 0;
            background: rgba(255,255,255,0.8);
            border-radius: 50%;
            transform: translateX(-50%);
            z-index: 6;
        }
        .splash.active { animation: splashAnim 0.5s ease-out; }

        @keyframes splashAnim {
            0% { width: 10px; height: 10px; bottom: 160px; opacity: 1; }
            50% { width: 60px; height: 60px; bottom: 190px; opacity: 0.8; }
            100% { width: 100px; height: 20px; bottom: 150px; opacity: 0; }
        }

    </style>
</head>
<body>

<div class="container">
    <div class="sidebar">
        <h2>ğŸ—ï¸ ç¢¼é ­æŠ½ç±¤æ©Ÿ</h2>
        <textarea id="nameList" placeholder="è¼¸å…¥åå–® (æ¯è¡Œä¸€å€‹):&#10;Batman&#10;Superman&#10;Spiderman&#10;Ironman&#10;Hulk">é™³å¤§æ–‡&#10;æå°æ˜&#10;å¼µä¸‰&#10;Amy&#10;Peter&#10;Sakamoto&#10;John&#10;Mary</textarea>
        
        <div class="btn-group">
            <button id="updateBtn" onclick="renderCrowd()">ğŸ”„ æ›´æ–°äººç¾¤</button>
            <button id="drawBtn" onclick="startDraw()">ğŸ£ å•Ÿå‹•èµ·é‡æ©Ÿ</button>
        </div>

        <div class="result-box">
            <h3>æ‰å·¦è½æµ·:</h3>
            <div class="result-name" id="resultName">---</div>
        </div>
    </div>

    <div class="game-area" id="gameArea">
        <div class="cloud c1"></div>
        <div class="cloud c2"></div>

        <div class="rail"></div>

        <div class="crane-wrapper" id="crane">
            <div class="crane-head"></div>
            <div class="rope" id="rope">
                <div class="claw" id="claw"></div>
                <div class="victim-on-claw" id="victimOnClaw">
                    <div class="avatar" id="clawAvatar">ğŸ˜­</div>
                    <div class="name" id="clawName">Name</div>
                </div>
            </div>
        </div>

        <div class="falling-victim" id="fallingVictim">
            <div class="person-avatar" id="fallingAvatar">ğŸ˜­</div>
            <div class="person-name" id="fallingName">Name</div>
        </div>

        <div class="splash" id="splash"></div>

        <div class="sea"></div>

        <div class="pier">
            <div class="crowd-container" id="crowdContainer">
                </div>
        </div>
    </div>
</div>

<script>
    // é…ç½®
    const emojis = ['ğŸ˜ƒ', 'ğŸ˜', 'ğŸ¤“', 'ğŸ˜', 'ğŸ˜³', 'ğŸ¤ ', 'ğŸ¥³', 'ğŸ§', 'ğŸ‘¶', 'ğŸ‘©', 'ğŸ‘¨', 'ğŸ‘´', 'ğŸ‘µ'];
    const dropZoneLeft = 150; // æ‰è½å€åŸŸï¼ˆæµ·çš„ä¸­å¿ƒé»ï¼‰è·é›¢å·¦é‚Šçš„ px

    // DOM å…ƒç´ 
    const nameListEl = document.getElementById('nameList');
    const crowdContainer = document.getElementById('crowdContainer');
    const crane = document.getElementById('crane');
    const rope = document.getElementById('rope');
    const claw = document.getElementById('claw');
    const victimOnClaw = document.getElementById('victimOnClaw');
    const clawAvatar = document.getElementById('clawAvatar');
    const clawName = document.getElementById('clawName');
    const fallingVictim = document.getElementById('fallingVictim');
    const fallingAvatar = document.getElementById('fallingAvatar');
    const fallingName = document.getElementById('fallingName');
    const splash = document.getElementById('splash');
    const resultNameEl = document.getElementById('resultName');
    const drawBtn = document.getElementById('drawBtn');

    let isAnimating = false;
    let personElements = []; // å„²å­˜ç”Ÿæˆçš„ DOM å…ƒç´ 

    // åˆå§‹åŒ–
    renderCrowd();

    // 1. ç”Ÿæˆäººç¾¤
    function renderCrowd() {
        if(isAnimating) return;
        
        crowdContainer.innerHTML = '';
        personElements = [];
        
        const names = nameListEl.value.split('\n').map(n => n.trim()).filter(n => n);
        
        if(names.length === 0) {
            crowdContainer.innerHTML = '<span style="color:#fff; font-size:12px;">ç„¡äººæ’éšŠ</span>';
            return;
        }

        names.forEach((name, index) => {
            const div = document.createElement('div');
            div.className = 'person';
            div.id = 'p-' + index;
            
            const avatar = emojis[Math.floor(Math.random() * emojis.length)];
            
            div.innerHTML = `
                <div class="person-avatar">${avatar}</div>
                <div class="person-name">${name}</div>
            `;
            
            // å­˜å„²æ•¸æ“šä»¥ä¾¿ä¹‹å¾Œè®€å–
            div.dataset.name = name;
            div.dataset.avatar = avatar;

            crowdContainer.appendChild(div);
            personElements.push(div);
        });

        // é‡ç½®èµ·é‡æ©Ÿä½ç½®åˆ°æµ·é¢ä¸Š
        resetCrane();
    }

    // 2. è¼”åŠ©å‡½æ•¸ï¼šç­‰å¾…
    const wait = (ms) => new Promise(resolve => setTimeout(resolve, ms));

    // 3. æ ¸å¿ƒæŠ½ç±¤é‚è¼¯
    async function startDraw() {
        if (isAnimating) return;
        if (personElements.length === 0) {
            alert('è«‹å…ˆè¼¸å…¥åå–®ä¸¦æ›´æ–°äººç¾¤ï¼');
            return;
        }

        isAnimating = true;
        drawBtn.disabled = true;
        resultNameEl.innerText = 'å°‹æ‰¾ç›®æ¨™...';
        
        // é¸ä¸­ä¸€å€‹å¹¸é‹å…’
        const randomIndex = Math.floor(Math.random() * personElements.length);
        const targetEl = personElements[randomIndex];
        const targetName = targetEl.dataset.name;
        const targetAvatar = targetEl.dataset.avatar;

        // è¨ˆç®—ç›®æ¨™ä½ç½® (ç›¸å°æ–¼ game-area å·¦é‚Šç•Œ)
        const gameAreaRect = document.getElementById('gameArea').getBoundingClientRect();
        const targetRect = targetEl.getBoundingClientRect();
        
        // ç›®æ¨™ä¸­å¿ƒé» X åº§æ¨™
        const targetX = (targetRect.left - gameAreaRect.left) + (targetRect.width / 2);
        // ç¹©å­éœ€è¦æ”¾ä¸‹çš„é•·åº¦ (ç›®æ¨™é ­é ‚ä½ç½®)
        // é ‚éƒ¨ rail åœ¨ top:40px, rope start at 60px. 
        // æˆ‘å€‘éœ€è¦ç®—å‡º rope åº•éƒ¨åˆ° target é ‚éƒ¨çš„è·é›¢
        const ropeStartTop = 60; // css top
        const targetTopRelative = targetRect.top - gameAreaRect.top;
        const dropHeight = targetTopRelative - ropeStartTop - 20; // -20 æ˜¯é ç•™æŠ“å–ç©ºé–“

        // --- å‹•ç•«é–‹å§‹ ---

        // A. èµ·é‡æ©Ÿç§»å‹•åˆ°ç›®æ¨™ä¸Šæ–¹
        crane.style.left = targetX + 'px';
        await wait(1500); // ç­‰å¾…ç§»å‹•æ™‚é–“

        // B. æ”¾ä¸‹ç¹©å­
        rope.style.height = dropHeight + 'px';
        await wait(1200);

        // C. æŠ“å–å‹•ä½œ
        claw.classList.add('closed'); // é–‰åˆçˆªå­
        await wait(200); 
        
        // åˆ‡æ›é¡¯ç¤ºï¼šéš±è—åœ°ä¸Šçš„äººï¼Œé¡¯ç¤ºçˆªå­ä¸Šçš„äºº
        targetEl.classList.add('chosen'); 
        victimOnClaw.style.display = 'flex';
        clawAvatar.innerText = 'ğŸ˜µ'; // æ›æˆæšˆå€’è¡¨æƒ…
        clawName.innerText = targetName;
        await wait(500);

        // D. æ‹‰èµ·ç¹©å­
        rope.style.height = '60px'; // æ”¶å›åˆå§‹é•·åº¦
        await wait(1200);

        // E. ç§»å‹•å›æµ·é¢ä¸Š (Drop Zone)
        crane.style.left = dropZoneLeft + 'px';
        await wait(1500);

        // F. æ‰è½
        claw.classList.remove('closed'); // æ‰“é–‹çˆªå­
        victimOnClaw.style.display = 'none'; // éš±è—çˆªä¸Šäºº
        
        // è¨­ç½®æ‰è½äººå¶çš„åˆå§‹ä½ç½®
        fallingVictim.style.display = 'flex';
        fallingVictim.style.left = dropZoneLeft + 'px'; // ç¢ºä¿æ°´å¹³ä½ç½®å°é½Š
        fallingVictim.style.top = (60 + 40) + 'px'; // ç¹©å­æ”¶èµ·çš„é«˜åº¦ + headé«˜åº¦
        fallingAvatar.innerText = targetAvatar; // æ¢å¾©åŸæœ¬è¡¨æƒ…æˆ–ä¿æŒæšˆå€’
        fallingName.innerText = targetName;
        
        // è§¸ç™¼æ‰è½å‹•ç•«
        fallingVictim.classList.add('animate');
        
        await wait(600); // ç­‰å¾…æ‰åˆ°æ°´é¢

        // G. æ°´èŠ±ç‰¹æ•ˆ
        splash.style.left = dropZoneLeft + 'px';
        splash.classList.add('active');
        
        // é¡¯ç¤ºçµæœ
        resultNameEl.innerText = targetName;
        
        await wait(1000); // ç¨ä½œåœé “

        // æ¸…ç†èˆ‡é‡ç½®ç‹€æ…‹
        isAnimating = false;
        drawBtn.disabled = false;
        
        // é‡ç½®æ‰è½äººå¶ (ä½†ä¸é‡ç½®åœ°ä¸Šçš„äººï¼Œè¡¨ç¤ºä»–å·²ç¶“ä¸åœ¨äº†)
        fallingVictim.style.display = 'none';
        fallingVictim.classList.remove('animate');
        splash.classList.remove('active');
        
        // å¦‚æœæƒ³ä¿ç•™è©²äººæ¶ˆå¤±çš„ç‹€æ…‹ï¼Œå°±ä¸åŸ·è¡Œ renderCrowd()
        // å¦‚æœæƒ³æ¯æ¬¡éƒ½é‡ç½®æ‰€æœ‰äººï¼Œå¯ä»¥è§£é–‹ä¸‹é¢é€™è¡Œè¨»é‡‹
        // renderCrowd(); 
    }

    function resetCrane() {
        crane.style.left = dropZoneLeft + 'px';
        rope.style.height = '50px';
        claw.classList.remove('closed');
        victimOnClaw.style.display = 'none';
        fallingVictim.style.display = 'none';
        splash.classList.remove('active');
    }

</script>

</body>
</html>