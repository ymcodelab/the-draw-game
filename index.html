<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¢¼é ­æŠ½ç±¤æ©Ÿ</title>
    <style>
        * { box-sizing: border-box; }
        body, html { margin: 0; padding: 0; height: 100%; font-family: "Microsoft JhengHei", sans-serif; overflow: hidden; }
        
        .container { display: flex; height: 100vh; }

        /* å·¦å´é¢æ¿ */
        .sidebar {
            width: 280px;
            background-color: #f8f9fa;
            padding: 20px;
            display: flex;
            flex-direction: column;
            border-right: 3px solid #ccc;
            z-index: 20;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        h2 { margin-top: 0; color: #333; font-size: 1.5rem; }
        
        textarea {
            width: 100%;
            height: 200px;
            margin-bottom: 10px;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        textarea:focus { border-color: #ff5722; outline: none; }

        .btn-group { display: flex; gap: 10px; margin-bottom: 20px; }
        
        button {
            flex: 1;
            padding: 12px;
            font-size: 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.1s;
        }
        button:active { transform: scale(0.95); }

        #updateBtn { background-color: #4CAF50; color: white; }
        #drawBtn { background-color: #ff5722; color: white; }
        #drawBtn:disabled { background-color: #ccc; cursor: not-allowed; }

        .result-box {
            margin-top: auto;
            padding: 20px;
            background: #e3f2fd;
            border: 2px dashed #2196f3;
            border-radius: 8px;
            text-align: center;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .result-box h3 { margin: 0 0 5px 0; font-size: 14px; color: #666; }
        .result-name { font-size: 24px; font-weight: bold; color: #d32f2f; }
        
        /* å‰©é¤˜äººæ•¸é¡¯ç¤º */
        .count-info {
            font-size: 12px; color: #666; text-align: right; margin-top: 5px;
        }

        /* å³å´éŠæˆ²å€ */
        .game-area {
            flex-grow: 1;
            position: relative;
            background: linear-gradient(to bottom, #B3E5FC 0%, #E1F5FE 60%, #4FC3F7 100%);
            overflow: hidden;
        }

        /* é›²æœµ */
        .cloud { position: absolute; background: rgba(255,255,255,0.8); border-radius: 50px; }
        .c1 { width: 100px; height: 40px; top: 10%; left: 10%; animation: float 20s infinite linear; }
        .c2 { width: 140px; height: 60px; top: 20%; left: 60%; animation: float 30s infinite linear reverse; }
        @keyframes float { from { transform: translateX(0); } to { transform: translateX(50px); } }

        /* å¤§æµ· */
        .sea {
            position: absolute;
            bottom: 0; left: 0; width: 70%; height: 180px;
            background: linear-gradient(to bottom, #0288d1 0%, #01579b 100%);
            z-index: 5; border-right: 5px solid rgba(0,0,0,0.1);
        }

        /* ç¢¼é ­å¹³åœ° */
        .pier {
            position: absolute; bottom: 0; right: 0; width: 30%; height: 180px;
            background: repeating-linear-gradient(45deg, #6d4c41, #6d4c41 10px, #5d4037 10px, #5d4037 20px);
            box-shadow: inset 5px 0 10px rgba(0,0,0,0.3);
            z-index: 5;
            display: flex; align-items: flex-end; justify-content: center;
            padding-bottom: 20px;
        }
        .pier::before { content: ''; position: absolute; left: 0; top: 10px; width: 10px; height: 100%; background: #3e2723; }

        /* äººç¾¤å®¹å™¨ */
        .crowd-container {
            width: 90%; display: flex; flex-wrap: wrap-reverse; 
            justify-content: center; gap: 5px; position: relative; z-index: 6;
        }

        /* å–®å€‹å°äººå¶ */
        .person {
            display: flex; flex-direction: column; align-items: center; width: 40px;
            transition: opacity 0.3s; position: relative;
        }
        .person-avatar { font-size: 30px; cursor: default; }
        .person-name { 
            background: rgba(255,255,255,0.9); font-size: 10px; padding: 1px 3px; 
            border-radius: 3px; white-space: nowrap; max-width: 60px; overflow: hidden; text-overflow: ellipsis;
        }
        .person.chosen { opacity: 0; pointer-events: none; } /* è¢«é¸ä¸­å¾Œå®Œå…¨ä¸å¯è¦‹ä¸å¯é» */

        /* èµ·é‡æ©Ÿ */
        .crane-wrapper { position: absolute; top: 0; left: 100px; height: 100%; width: 100px; z-index: 10; transition: left 1s ease-in-out; }
        .rail { position: absolute; top: 40px; left: 0; width: 100%; height: 10px; background: #555; z-index: 9; }
        .crane-head { position: absolute; top: 30px; left: -20px; width: 40px; height: 30px; background: #fbc02d; border: 2px solid #f57f17; border-radius: 5px; }
        .rope { position: absolute; top: 60px; left: 0; width: 4px; height: 50px; background: #333; transform: translateX(-50%); transition: height 1s linear; }
        .claw { position: absolute; bottom: -25px; left: -15px; width: 34px; height: 25px; border: 4px solid #444; border-top: none; border-radius: 0 0 15px 15px; transition: transform 0.2s; }
        .claw.closed { transform: scaleX(0.7); border-color: #d32f2f; }

        /* è¢«æŠ“çš„äºº */
        .victim-on-claw { position: absolute; top: 100%; left: 50%; transform: translateX(-50%); display: none; flex-direction: column; align-items: center; }
        .victim-on-claw .avatar { font-size: 35px; animation: struggle 0.2s infinite alternate; }
        .victim-on-claw .name { background: #fff; padding: 2px 5px; border-radius: 4px; font-weight: bold; font-size: 12px; border: 1px solid #333; }
        @keyframes struggle { from { transform: rotate(-15deg); } to { transform: rotate(15deg); } }

        /* æ‰è½çš„äºº */
        .falling-victim { position: absolute; display: none; flex-direction: column; align-items: center; z-index: 8; }
        .falling-victim.animate { animation: dropAnim 0.8s cubic-bezier(0.6, 0.04, 0.98, 0.335) forwards; }
        @keyframes dropAnim {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            80% { opacity: 1; }
            100% { transform: translateY(400px) rotate(180deg); opacity: 0; }
        }

        /* æ°´èŠ± */
        .splash { position: absolute; bottom: 160px; left: 0; width: 0; height: 0; background: rgba(255,255,255,0.8); border-radius: 50%; transform: translateX(-50%); z-index: 6; }
        .splash.active { animation: splashAnim 0.5s ease-out; }
        @keyframes splashAnim {
            0% { width: 10px; height: 10px; bottom: 160px; opacity: 1; }
            50% { width: 60px; height: 60px; bottom: 190px; opacity: 0.8; }
            100% { width: 100px; height: 20px; bottom: 150px; opacity: 0; }
        }

    </style>
</head>
<body>

<div class="container">
    <div class="sidebar">
        <h2>ğŸ—ï¸ ç¢¼é ­æŠ½ç±¤æ©Ÿ</h2>
        <textarea id="nameList" placeholder="è¼¸å…¥åå–® (æ¯è¡Œä¸€å€‹):&#10;Batman&#10;Superman&#10;Spiderman">é™³å¤§æ–‡&#10;æå°æ˜&#10;å¼µä¸‰&#10;Amy&#10;Peter&#10;Sakamoto&#10;John&#10;Mary</textarea>
        
        <div class="btn-group">
            <button id="updateBtn" onclick="renderCrowd()">ğŸ”„ æ›´æ–°äººç¾¤</button>
            <button id="drawBtn" onclick="startDraw()">ğŸ£ å•Ÿå‹•-æ‰ä½¢è½æµ·</button>
        </div>
        
        <div class="count-info" id="countInfo">æ­»å‰©ç¨®äººæ•¸: 0</div>

        <div class="result-box">
            <h3>æ‰å’—è½æµ·:</h3>
            <div class="result-name" id="resultName">---</div>
        </div>
    </div>

    <div class="game-area" id="gameArea">
        <div class="cloud c1"></div>
        <div class="cloud c2"></div>
        <div class="rail"></div>

        <div class="crane-wrapper" id="crane">
            <div class="crane-head"></div>
            <div class="rope" id="rope">
                <div class="claw" id="claw"></div>
                <div class="victim-on-claw" id="victimOnClaw">
                    <div class="avatar" id="clawAvatar">ğŸ˜­</div>
                    <div class="name" id="clawName">Name</div>
                </div>
            </div>
        </div>

        <div class="falling-victim" id="fallingVictim">
            <div class="person-avatar" id="fallingAvatar">ğŸ˜­</div>
            <div class="person-name" id="fallingName">Name</div>
        </div>

        <div class="splash" id="splash"></div>
        <div class="sea"></div>
        <div class="pier">
            <div class="crowd-container" id="crowdContainer"></div>
        </div>
    </div>
</div>

<script>
    // é…ç½®
    const emojis = ['ğŸ˜ƒ', 'ğŸ˜', 'ğŸ¤“', 'ğŸ˜', 'ğŸ˜³', 'ğŸ¤ ', 'ğŸ¥³', 'ğŸ§', 'ğŸ‘¶', 'ğŸ‘©', 'ğŸ‘¨', 'ğŸ‘´', 'ğŸ‘µ'];
    const dropZoneLeft = 150; 

    // DOM
    const nameListEl = document.getElementById('nameList');
    const crowdContainer = document.getElementById('crowdContainer');
    const crane = document.getElementById('crane');
    const rope = document.getElementById('rope');
    const claw = document.getElementById('claw');
    const victimOnClaw = document.getElementById('victimOnClaw');
    const clawAvatar = document.getElementById('clawAvatar');
    const clawName = document.getElementById('clawName');
    const fallingVictim = document.getElementById('fallingVictim');
    const fallingAvatar = document.getElementById('fallingAvatar');
    const fallingName = document.getElementById('fallingName');
    const splash = document.getElementById('splash');
    const resultNameEl = document.getElementById('resultName');
    const drawBtn = document.getElementById('drawBtn');
    const countInfo = document.getElementById('countInfo');

    let isAnimating = false;
    let personElements = []; // é€™æ˜¯é‚„åœ¨ç¢¼é ­ä¸Šçš„æ´»äººåå–®

    // åˆå§‹åŒ–
    renderCrowd();

    // 1. ç”Ÿæˆäººç¾¤ (é‡ç½®éŠæˆ²)
    function renderCrowd() {
        if(isAnimating) return;
        
        crowdContainer.innerHTML = '';
        personElements = [];
        
        const names = nameListEl.value.split('\n').map(n => n.trim()).filter(n => n);
        
        if(names.length === 0) {
            crowdContainer.innerHTML = '<span style="color:#fff; font-size:12px;">ç„¡äººæ’éšŠ</span>';
            countInfo.innerText = "æ­»å‰©ç¨®äººæ•¸: 0";
            return;
        }

        names.forEach((name, index) => {
            const div = document.createElement('div');
            div.className = 'person';
            div.id = 'p-' + index;
            
            const avatar = emojis[Math.floor(Math.random() * emojis.length)];
            
            div.innerHTML = `
                <div class="person-avatar">${avatar}</div>
                <div class="person-name">${name}</div>
            `;
            
            div.dataset.name = name;
            div.dataset.avatar = avatar;

            crowdContainer.appendChild(div);
            personElements.push(div); // åŠ å…¥ç­‰å¾…åå–®
        });

        countInfo.innerText = `æ­»å‰©ç¨®äººæ•¸: ${personElements.length}`;
        resultNameEl.innerText = "---";
        resultNameEl.style.color = "#d32f2f";
        resetCrane();
    }

    const wait = (ms) => new Promise(resolve => setTimeout(resolve, ms));

    // 2. æŠ½ç±¤é‚è¼¯ (æ›´æ–°ç‰ˆ)
    async function startDraw() {
        if (isAnimating) return;
        
        // æª¢æŸ¥æ˜¯å¦é‚„æœ‰äºº
        if (personElements.length === 0) {
            alert('ğŸ˜± æ‰€æœ‰äººéƒ½åœ¨æµ·è£¡äº†ï¼\nè«‹æŒ‰ã€Œæ›´æ–°äººç¾¤ã€é‡æ–°é–‹å§‹ã€‚');
            return;
        }

        isAnimating = true;
        drawBtn.disabled = true;
        resultNameEl.innerText = 'å°‹æ‰¾ç›®æ¨™...';
        resultNameEl.style.color = "#999";
        
        // --- é—œéµä¿®æ”¹ï¼šæŠ½å‡ºå¾Œå¾ Array ä¸­ç§»é™¤ ---
        const randomIndex = Math.floor(Math.random() * personElements.length);
        const targetEl = personElements[randomIndex]; // ç²å– DOM å…ƒç´ 
        
        // ç«‹åˆ»å¾åå–®ä¸­ç§»é™¤ï¼Œç¢ºä¿ä¸‹æ¬¡ä¸æœƒå†æŠ½ä¸­
        personElements.splice(randomIndex, 1);
        countInfo.innerText = `æ­»å‰©ç¨®äººæ•¸: ${personElements.length}`;

        const targetName = targetEl.dataset.name;
        const targetAvatar = targetEl.dataset.avatar;

        // è¨ˆç®—ä½ç½®
        const gameAreaRect = document.getElementById('gameArea').getBoundingClientRect();
        const targetRect = targetEl.getBoundingClientRect();
        const targetX = (targetRect.left - gameAreaRect.left) + (targetRect.width / 2);
        const ropeStartTop = 60; 
        const targetTopRelative = targetRect.top - gameAreaRect.top;
        const dropHeight = targetTopRelative - ropeStartTop - 20;

        // å‹•ç•«åºåˆ—
        // A. ç§»å‹•
        crane.style.left = targetX + 'px';
        await wait(1500);

        // B. æ”¾ç¹©
        rope.style.height = dropHeight + 'px';
        await wait(1200);

        // C. æŠ“å–
        claw.classList.add('closed'); 
        await wait(200); 
        
        targetEl.classList.add('chosen'); // åœ°ä¸Šçš„äººæ¶ˆå¤±
        victimOnClaw.style.display = 'flex'; // çˆªä¸Šçš„äººå‡ºç¾
        clawAvatar.innerText = 'ğŸ˜µ';
        clawName.innerText = targetName;
        await wait(500);

        // D. æ‹‰èµ·
        rope.style.height = '60px'; 
        await wait(1200);

        // E. é‹é€
        crane.style.left = dropZoneLeft + 'px';
        await wait(1500);

        // F. æ‰è½
        claw.classList.remove('closed'); 
        victimOnClaw.style.display = 'none'; 
        
        fallingVictim.style.display = 'flex';
        fallingVictim.style.left = dropZoneLeft + 'px'; 
        fallingVictim.style.top = (60 + 40) + 'px';
        fallingAvatar.innerText = targetAvatar; 
        fallingName.innerText = targetName;
        
        fallingVictim.classList.add('animate');
        
        await wait(600); 

        // G. æ°´èŠ± + çµæœ
        splash.style.left = dropZoneLeft + 'px';
        splash.classList.add('active');
        
        resultNameEl.innerText = targetName;
        resultNameEl.style.color = "#d32f2f";
        
        await wait(1000); 

        isAnimating = false;
        drawBtn.disabled = false;
        
        fallingVictim.style.display = 'none';
        fallingVictim.classList.remove('animate');
        splash.classList.remove('active');
        
        // é€™è£¡ä¸å†å‘¼å« renderCrowdï¼Œå› ç‚ºæˆ‘å€‘è¦ä¿æŒã€Œäººè®Šå°‘äº†ã€çš„ç‹€æ…‹
    }

    function resetCrane() {
        crane.style.left = dropZoneLeft + 'px';
        rope.style.height = '50px';
        claw.classList.remove('closed');
        victimOnClaw.style.display = 'none';
        fallingVictim.style.display = 'none';
        splash.classList.remove('active');
    }

</script>

</body>
</html>
